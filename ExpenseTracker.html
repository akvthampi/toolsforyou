<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Personal Expense Tracker</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #333;
            line-height: 1.4;
            padding: 12px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            padding: 15px;
            overflow: hidden;
            display: grid;
            grid-template-columns: 300px 1fr;
            grid-template-rows: auto 1fr auto;
            gap: 15px;
            grid-template-areas: 
                "header header"
                "sidebar main"
                "status status";
            min-height: 90vh;
        }
        
        header {
            grid-area: header;
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eaeaea;
        }
        
        h1 {
            color: #2c5364;
            margin-bottom: 8px;
            font-size: 1.8rem;
        }
        
        .description {
            color: #7f8c8d;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .database-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-primary {
            background: linear-gradient(to right, #2c5364, #203a43);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .btn-success {
            background: linear-gradient(to right, #4CAF50, #2E7D32);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(to right, #F44336, #C62828);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(to right, #FF9800, #F57C00);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(to right, #2196F3, #1976D2);
            color: white;
        }
        
        .btn-print {
            background: linear-gradient(to right, #9C27B0, #7B1FA2);
            color: white;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .summary-card {
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .summary-card.total {
            background: linear-gradient(to right, #E3F2FD, #BBDEFB);
            border-left: 4px solid #2196F3;
        }
        
        .summary-card.income {
            background: linear-gradient(to right, #E8F5E9, #C8E6C9);
            border-left: 4px solid #4CAF50;
        }
        
        .summary-card.expense {
            background: linear-gradient(to right, #FFF3E0, #FFE0B2);
            border-left: 4px solid #FF9800;
        }
        
        .summary-card.balance {
            background: linear-gradient(to right, #FFEBEE, #FFCDD2);
            border-left: 4px solid #F44336;
        }
        
        .summary-card h3 {
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: #455A64;
        }
        
        .summary-card .amount {
            font-size: 1.4rem;
            font-weight: bold;
        }
        
        .summary-card.total .amount {
            color: #1565C0;
        }
        
        .summary-card.income .amount {
            color: #2E7D32;
        }
        
        .summary-card.expense .amount {
            color: #EF6C00;
        }
        
        .summary-card.balance .amount {
            color: #C62828;
        }
        
        .sidebar {
            grid-area: sidebar;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .main-content {
            grid-area: main;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .view-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .view-btn {
            padding: 8px 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            background: #f8f9fa;
            cursor: pointer;
            font-weight: 600;
        }
        
        .view-btn.active {
            background: #2c5364;
            color: white;
        }
        
        .form-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .form-title {
            margin-bottom: 12px;
            color: #495057;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .form-group {
            margin-bottom: 10px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
            font-size: 0.85rem;
        }
        
        input[type="date"],
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #2c5364;
            box-shadow: 0 0 0 2px rgba(44, 83, 100, 0.2);
        }
        
        .task-list-container {
            flex: 1;
            overflow: auto;
        }
        
        .task-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 0.8rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .task-table th, 
        .task-table td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        .task-table th {
            background: #f8f9fa;
            color: #495057;
            font-weight: 600;
            position: sticky;
            top: 0;
            font-size: 0.85rem;
        }
        
        .task-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .task-table tr:hover {
            background-color: #e9ecef;
        }
        
        .positive {
            color: #2E7D32;
            font-weight: bold;
        }
        
        .negative {
            color: #C62828;
            font-weight: bold;
        }
        
        .actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-sm {
            padding: 4px 8px;
            font-size: 0.75rem;
            border-radius: 3px;
        }
        
        .status-bar {
            grid-area: status;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 8px;
            border-left: 3px solid #2c5364;
            font-size: 0.85rem;
        }
        
        .status-message {
            font-weight: 600;
            color: #495057;
            font-size: 0.85rem;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            display: inline-block;
            padding: 8px 15px;
            background: #203a43;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 0.85rem;
        }
        
        .file-label:hover {
            background: #1a3038;
        }
        
        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 10px 20px;
            border-radius: 6px;
            color: white;
            opacity: 0;
            transform: translateX(100%);
            transition: opacity 0.3s, transform 0.3s;
            z-index: 1000;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            font-size: 0.9rem;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(to right, #4CAF50, #2E7D32);
        }
        
        .notification.error {
            background: linear-gradient(to right, #F44336, #C62828);
        }
        
        .search-container {
            margin-bottom: 12px;
            display: flex;
            gap: 8px;
        }
        
        .search-input {
            flex: 1;
            padding: 8px 15px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .hidden {
            display: none;
        }
        
        .icon {
            margin-right: 5px;
            font-size: 0.9rem;
        }
        
        .print-controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: end;
        }
        
        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background: #4CAF50;
            border-radius: 4px;
        }
        
        .chart-container {
            width: 100%;
            height: 300px;
            margin-top: 20px;
        }
        
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "header"
                    "main"
                    "sidebar"
                    "status";
            }
            
            .sidebar {
                order: 3;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .database-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 8px;
            }
            
            .task-table th, 
            .task-table td {
                padding: 4px 6px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .print-controls {
                flex-direction: column;
            }
            
            .view-controls {
                flex-wrap: wrap;
            }
        }
        
        /* Print styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            #printable-expenses, #printable-expenses * {
                visibility: visible;
            }
            
            #printable-expenses {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            
            .no-print {
                display: none !important;
            }
        }
        
        .print-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-family: Arial, sans-serif;
            font-size: 14px;
        }
        
        .print-table th, .print-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        .print-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        .print-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .print-period {
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .print-summary {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        
        .download-link {
            display: none;
        }
        
        .category-color {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .budget-normal {
            background: #4CAF50;
        }
        
        .budget-warning {
            background: #FF9800;
        }
        
        .budget-danger {
            background: #F44336;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Advanced Personal Expense Tracker</h1>
            <p class="description">Manage your finances with advanced features and reporting</p>
            
            <div class="database-actions no-print">
                <input type="file" id="dbFile" accept=".json" class="file-input">
                <label for="dbFile" class="file-label">
                    <span class="icon">üìÅ</span>Load Data
                </label>
                <button id="createDb" class="btn btn-primary">
                    <span class="icon">‚ûï</span>New Expense File
                </button>
                <button id="saveDb" class="btn btn-secondary">
                    <span class="icon">üíæ</span>Save Data
                </button>
                <button id="exampleData" class="btn btn-secondary">
                    <span class="icon">üîç</span>Example Data
                </button>
            </div>
            
            <div class="summary-cards no-print">
                <div class="summary-card total">
                    <h3>Total Balance</h3>
                    <div class="amount" id="totalBalance">‚Çπ0.00</div>
                </div>
                <div class="summary-card income">
                    <h3>Total Income</h3>
                    <div class="amount" id="totalIncome">‚Çπ0.00</div>
                </div>
                <div class="summary-card expense">
                    <h3>Total Expenses</h3>
                    <div class="amount" id="totalExpenses">‚Çπ0.00</div>
                </div>
                <div class="summary-card balance">
                    <h3>Net Cash Flow</h3>
                    <div class="amount" id="netCashFlow">‚Çπ0.00</div>
                </div>
            </div>
        </header>
        
        <div class="sidebar no-print">
            <div class="form-container">
                <div class="form-title">
                    <span>Quick Actions</span>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="switchView('dashboard')">Dashboard</button>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="switchView('accounts')">Accounts</button>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="switchView('categories')">Categories</button>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="switchView('transactions')">Transactions</button>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="switchView('budget')">Budget</button>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="switchView('transfer')">Transfer</button>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="switchView('reports')">Reports</button>
                </div>
            </div>
            
            <div class="form-container">
                <div class="form-title">
                    <span>Filters</span>
                </div>
                <div class="form-group">
                    <label for="filterDateFrom">From Date</label>
                    <input type="date" id="filterDateFrom">
                </div>
                <div class="form-group">
                    <label for="filterDateTo">To Date</label>
                    <input type="date" id="filterDateTo">
                </div>
                <div class="form-group">
                    <label for="filterAccount">Account</label>
                    <select id="filterAccount">
                        <option value="">All Accounts</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="filterCategory">Category</label>
                    <select id="filterCategory">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <button id="applyFilters" class="btn btn-primary">Apply Filters</button>
                <button id="clearFilters" class="btn btn-secondary">Clear Filters</button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="view-controls no-print">
                <button class="view-btn active" data-view="dashboard">Dashboard</button>
                <button class="view-btn" data-view="accounts">Accounts</button>
                <button class="view-btn" data-view="categories">Categories</button>
                <button class="view-btn" data-view="transactions">Transactions</button>
                <button class="view-btn" data-view="budget">Budget</button>
                <button class="view-btn" data-view="transfer">Transfer</button>
                <button class="view-btn" data-view="reports">Reports</button>
            </div>
            
            <!-- Dashboard View -->
            <div id="dashboardView" class="form-container">
                <div class="form-title">
                    <span>Financial Overview</span>
                </div>
                <div class="chart-container">
                    <canvas id="overviewChart"></canvas>
                </div>
                
                <div class="form-title" style="margin-top: 20px;">
                    <span>Recent Transactions</span>
                </div>
                <div class="task-list-container">
                    <table class="task-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Account</th>
                                <th>Category</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody id="recentTransactions">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Accounts View -->
            <div id="accountsView" class="form-container hidden">
                <div class="form-title">
                    <span>Manage Accounts</span>
                </div>
                <form id="accountForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="accountName">Account Name</label>
                            <input type="text" id="accountName" placeholder="e.g., Checking Account" required>
                        </div>
                        <div class="form-group">
                            <label for="accountType">Account Type</label>
                            <select id="accountType" required>
                                <option value="Checking">Checking Account</option>
                                <option value="Savings">Savings Account</option>
                                <option value="Credit Card">Credit Card</option>
                                <option value="Loan">Loan Account</option>
                                <option value="Investment">Investment Account</option>
                                <option value="Cash">Cash</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="openingBalance">Opening Balance</label>
                            <input type="number" id="openingBalance" placeholder="0.00" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">
                            <span class="icon">üíæ</span>Add Account
                        </button>
                    </div>
                </form>
                
                <div class="form-title" style="margin-top: 20px;">
                    <span>Your Accounts</span>
                </div>
                <div class="task-list-container">
                    <table class="task-table">
                        <thead>
                            <tr>
                                <th>Account Name</th>
                                <th>Type</th>
                                <th>Balance</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="accountsTable">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Categories View -->
            <div id="categoriesView" class="form-container hidden">
                <div class="form-title">
                    <span>Manage Categories</span>
                </div>
                <form id="categoryForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="categoryName">Category Name</label>
                            <input type="text" id="categoryName" placeholder="e.g., Food & Dining" required>
                        </div>
                        <div class="form-group">
                            <label for="categoryType">Category Type</label>
                            <select id="categoryType" required>
                                <option value="expense">Expense</option>
                                <option value="income">Income</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="categoryColor">Color</label>
                            <input type="color" id="categoryColor" value="#4CAF50">
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">
                            <span class="icon">üíæ</span>Add Category
                        </button>
                    </div>
                </form>
                
                <div class="form-title" style="margin-top: 20px;">
                    <span>Your Categories</span>
                </div>
                <div class="task-list-container">
                    <table class="task-table">
                        <thead>
                            <tr>
                                <th>Category Name</th>
                                <th>Type</th>
                                <th>Color</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesTable">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Transactions View -->
            <div id="transactionsView" class="form-container hidden">
                <div class="form-title">
                    <span>Add Transaction</span>
                </div>
                <form id="transactionForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="transactionDate">Date</label>
                            <input type="date" id="transactionDate" required>
                        </div>
                        <div class="form-group">
                            <label for="transactionDescription">Description</label>
                            <input type="text" id="transactionDescription" placeholder="Transaction description" required>
                        </div>
                        <div class="form-group">
                            <label for="transactionAccount">Account</label>
                            <select id="transactionAccount" required>
                            </select>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="transactionCategory">Category</label>
                            <select id="transactionCategory" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transactionAmount">Amount</label>
                            <input type="number" id="transactionAmount" placeholder="0.00" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="transactionType">Type</label>
                            <select id="transactionType" required>
                                <option value="expense">Expense</option>
                                <option value="income">Income</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">
                            <span class="icon">üíæ</span>Add Transaction
                        </button>
                    </div>
                </form>
                
                <div class="form-title" style="margin-top: 20px;">
                    <span>Transaction History</span>
                </div>
                <div class="search-container">
                    <input type="text" id="searchTransactions" class="search-input" placeholder="Search transactions...">
                    <button id="clearTransactionSearch" class="btn btn-secondary">
                        <span class="icon">‚úñ</span>Clear
                    </button>
                </div>
                <div class="task-list-container">
                    <table class="task-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Account</th>
                                <th>Category</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsTable">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Budget View -->
            <div id="budgetView" class="form-container hidden">
                <div class="form-title">
                    <span>Set Budget</span>
                </div>
                <form id="budgetForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="budgetCategory">Category</label>
                            <select id="budgetCategory" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="budgetAmount">Monthly Budget Amount</label>
                            <input type="number" id="budgetAmount" placeholder="0.00" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">
                            <span class="icon">üíæ</span>Set Budget
                        </button>
                    </div>
                </form>
                
                <div class="form-title" style="margin-top: 20px;">
                    <span>Budget Overview</span>
                </div>
                <div id="budgetOverview">
                </div>
            </div>
            
            <!-- Transfer View -->
            <div id="transferView" class="form-container hidden">
                <div class="form-title">
                    <span>Transfer Money</span>
                </div>
                <form id="transferForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="fromAccount">From Account</label>
                            <select id="fromAccount" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="toAccount">To Account</label>
                            <select id="toAccount" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transferAmount">Amount</label>
                            <input type="number" id="transferAmount" placeholder="0.00" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="transferDescription">Description</label>
                            <input type="text" id="transferDescription" placeholder="Transfer description" required>
                        </div>
                        <div class="form-group">
                            <label for="transferDate">Date</label>
                            <input type="date" id="transferDate" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-success">
                            <span class="icon">üí∏</span>Transfer Money
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Reports View -->
            <div id="reportsView" class="form-container hidden">
                <div class="form-title">
                    <span>Financial Reports</span>
                </div>
                
                <div class="print-controls">
                    <div class="form-group">
                        <label for="reportStartDate">Start Date</label>
                        <input type="date" id="reportStartDate">
                    </div>
                    <div class="form-group">
                        <label for="reportEndDate">End Date</label>
                        <input type="date" id="reportEndDate">
                    </div>
                    <div class="form-group">
                        <button id="generateReport" class="btn btn-primary">
                            <span class="icon">üìä</span>Generate Report
                        </button>
                    </div>
                    <div class="form-group">
                        <button id="printReport" class="btn btn-print">
                            <span class="icon">üñ®Ô∏è</span>Print Report
                        </button>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
                
                <div class="form-title" style="margin-top: 20px;">
                    <span>Category-wise Expenditure</span>
                </div>
                <div class="task-list-container">
                    <table class="task-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Amount</th>
                                <th>Percentage</th>
                            </tr>
                        </thead>
                        <tbody id="categoryReportTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="status-bar no-print">
            <div class="status-message" id="statusMessage">No expense data loaded</div>
            <div id="transactionCount">0 transactions</div>
        </div>
        
        <!-- Printable expenses section (hidden by default) -->
        <div id="printable-expenses" style="display: none;">
            <div class="print-header">
                <h2>Expense Report</h2>
                <div class="print-period" id="print-period">For the period: </div>
            </div>
            
            <table class="print-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Description</th>
                        <th>Account</th>
                        <th>Category</th>
                        <th>Type</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody id="print-table-body">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
            
            <div class="print-summary">
                <p>Total Income: <span id="print-total-income">‚Çπ0.00</span></p>
                <p>Total Expenses: <span id="print-total-expenses">‚Çπ0.00</span></p>
                <p>Net Cash Flow: <span id="print-net-cash-flow">‚Çπ0.00</span></p>
            </div>
        </div>

        <!-- Hidden download link for saving files -->
        <a id="downloadLink" class="download-link"></a>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <script>
        // Global variables
        let accounts = [];
        let categories = [];
        let transactions = [];
        let budgets = {};
        let nextId = 1;
        let overviewChart = null;
        let categoryChart = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default
            const today = new Date();
            document.getElementById('transactionDate').valueAsDate = today;
            document.getElementById('transferDate').valueAsDate = today;
            
            // Set default date range for reporting (current month)
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            document.getElementById('reportStartDate').valueAsDate = firstDay;
            document.getElementById('reportEndDate').valueAsDate = lastDay;
            document.getElementById('filterDateFrom').valueAsDate = firstDay;
            document.getElementById('filterDateTo').valueAsDate = lastDay;
            
            // Event listeners
            document.getElementById('createDb').addEventListener('click', createDatabase);
            document.getElementById('saveDb').addEventListener('click', saveDatabase);
            document.getElementById('dbFile').addEventListener('change', loadDatabase);
            document.getElementById('exampleData').addEventListener('click', loadExampleData);
            document.getElementById('accountForm').addEventListener('submit', saveAccount);
            document.getElementById('categoryForm').addEventListener('submit', saveCategory);
            document.getElementById('transactionForm').addEventListener('submit', saveTransaction);
            document.getElementById('budgetForm').addEventListener('submit', saveBudget);
            document.getElementById('transferForm').addEventListener('submit', processTransfer);
            document.getElementById('searchTransactions').addEventListener('input', filterTransactions);
            document.getElementById('clearTransactionSearch').addEventListener('click', clearTransactionSearch);
            document.getElementById('applyFilters').addEventListener('click', applyFilters);
            document.getElementById('clearFilters').addEventListener('click', clearFilters);
            document.getElementById('generateReport').addEventListener('click', generateReport);
            document.getElementById('printReport').addEventListener('click', printReport);
            
            // View controls
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    switchView(this.dataset.view);
                });
            });
            
            // Initial UI update
            createDatabase();
        });
        
        // Create a new database
        function createDatabase() {
            accounts = [];
            categories = [];
            transactions = [];
            budgets = {};
            nextId = 1;
            
            // Add default categories
            const defaultCategories = [
                { id: nextId++, name: 'Food & Dining', type: 'expense', color: '#FF6384' },
                { id: nextId++, name: 'Transportation', type: 'expense', color: '#36A2EB' },
                { id: nextId++, name: 'Utilities', type: 'expense', color: '#FFCE56' },
                { id: nextId++, name: 'Entertainment', type: 'expense', color: '#4BC0C0' },
                { id: nextId++, name: 'Healthcare', type: 'expense', color: '#9966FF' },
                { id: nextId++, name: 'Shopping', type: 'expense', color: '#FF9F40' },
                { id: nextId++, name: 'Salary', type: 'income', color: '#4CAF50' },
                { id: nextId++, name: 'Freelance', type: 'income', color: '#8BC34A' },
                { id: nextId++, name: 'Investment', type: 'income', color: '#CDDC39' }
            ];
            
            categories = defaultCategories;
            
            updateUI();
            showNotification('New expense file created successfully.', 'success');
        }
        
        // Save database to file
        function saveDatabase() {
            if (accounts.length === 0 && transactions.length === 0) {
                showNotification('No data to save.', 'error');
                return;
            }
            
            try {
                const data = {
                    accounts: accounts,
                    categories: categories,
                    transactions: transactions,
                    budgets: budgets,
                    nextId: nextId
                };
                
                const dataStr = JSON.stringify(data);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                // Create a download link and trigger click
                const downloadLink = document.getElementById('downloadLink');
                const url = URL.createObjectURL(dataBlob);
                downloadLink.href = url;
                downloadLink.download = 'expense_data.json';
                downloadLink.click();
                
                // Clean up
                setTimeout(function() {
                    URL.revokeObjectURL(url);
                }, 100);
                
                showNotification('Expense data saved successfully.', 'success');
            } catch (error) {
                showNotification('Error saving database: ' + error.message, 'error');
            }
        }
        
        // Load database from file
        function loadDatabase(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    accounts = data.accounts || [];
                    categories = data.categories || [];
                    transactions = data.transactions || [];
                    budgets = data.budgets || {};
                    nextId = data.nextId || 1;
                    
                    updateUI();
                    showNotification('Expense data loaded successfully.', 'success');
                } catch (error) {
                    showNotification('Error loading database: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }
        
        // Load example data
        function loadExampleData() {
            createDatabase();
            
            // Add example accounts
            const exampleAccounts = [
                { id: nextId++, name: 'Checking Account', type: 'Checking', balance: 10000 },
                { id: nextId++, name: 'Savings Account', type: 'Savings', balance: 25000 },
                { id: nextId++, name: 'Credit Card', type: 'Credit Card', balance: -5000 },
                { id: nextId++, name: 'Cash', type: 'Cash', balance: 2000 }
            ];
            
            accounts = exampleAccounts;
            
            // Add example transactions
            const today = new Date();
            const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 15);
            const lastWeek = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 7);
            
            const exampleTransactions = [
                {
                    id: nextId++,
                    date: lastMonth.toISOString().slice(0,10),
                    description: 'Monthly Salary',
                    accountId: 1,
                    categoryId: 7,
                    amount: 50000,
                    type: 'income'
                },
                {
                    id: nextId++,
                    date: lastMonth.toISOString().slice(0,10),
                    description: 'Grocery Shopping',
                    accountId: 1,
                    categoryId: 1,
                    amount: 3500,
                    type: 'expense'
                },
                {
                    id: nextId++,
                    date: lastMonth.toISOString().slice(0,10),
                    description: 'Electricity Bill',
                    accountId: 1,
                    categoryId: 3,
                    amount: 2500,
                    type: 'expense'
                },
                {
                    id: nextId++,
                    date: lastWeek.toISOString().slice(0,10),
                    description: 'Dinner with Friends',
                    accountId: 3,
                    categoryId: 1,
                    amount: 1800,
                    type: 'expense'
                },
                {
                    id: nextId++,
                    date: lastWeek.toISOString().slice(0,10),
                    description: 'Uber Rides',
                    accountId: 3,
                    categoryId: 2,
                    amount: 1200,
                    type: 'expense'
                },
                {
                    id: nextId++,
                    date: today.toISOString().slice(0,10),
                    description: 'Freelance Project',
                    accountId: 1,
                    categoryId: 8,
                    amount: 15000,
                    type: 'income'
                }
            ];
            
            transactions = exampleTransactions;
            
            // Add example budgets
            budgets = {
                1: 5000, // Food & Dining
                2: 3000, // Transportation
                3: 4000, // Utilities
                4: 2000, // Entertainment
                5: 1500, // Healthcare
                6: 4000  // Shopping
            };
            
            updateUI();
            showNotification('Example data loaded successfully.', 'success');
        }
        
        // Save account
        function saveAccount(event) {
            event.preventDefault();
            
            try {
                const name = document.getElementById('accountName').value.trim();
                const type = document.getElementById('accountType').value;
                const balance = parseFloat(document.getElementById('openingBalance').value) || 0;
                
                if (!name) {
                    showNotification('Please enter an account name', 'error');
                    return;
                }
                
                const newAccount = {
                    id: nextId++,
                    name: name,
                    type: type,
                    balance: balance
                };
                
                accounts.push(newAccount);
                updateUI();
                
                // Reset form
                document.getElementById('accountForm').reset();
                
                showNotification('Account added successfully.', 'success');
            } catch (error) {
                showNotification('Error saving account: ' + error.message, 'error');
            }
        }
        
        // Save category
        function saveCategory(event) {
            event.preventDefault();
            
            try {
                const name = document.getElementById('categoryName').value.trim();
                const type = document.getElementById('categoryType').value;
                const color = document.getElementById('categoryColor').value;
                
                if (!name) {
                    showNotification('Please enter a category name', 'error');
                    return;
                }
                
                const newCategory = {
                    id: nextId++,
                    name: name,
                    type: type,
                    color: color
                };
                
                categories.push(newCategory);
                updateUI();
                
                // Reset form
                document.getElementById('categoryForm').reset();
                
                showNotification('Category added successfully.', 'success');
            } catch (error) {
                showNotification('Error saving category: ' + error.message, 'error');
            }
        }
        
        // Save transaction
        function saveTransaction(event) {
            event.preventDefault();
            
            try {
                const date = document.getElementById('transactionDate').value;
                const description = document.getElementById('transactionDescription').value.trim();
                const accountId = parseInt(document.getElementById('transactionAccount').value);
                const categoryId = parseInt(document.getElementById('transactionCategory').value);
                const amount = parseFloat(document.getElementById('transactionAmount').value);
                const type = document.getElementById('transactionType').value;
                
                if (!date || !description || !accountId || !categoryId || !amount) {
                    showNotification('Please fill in all fields', 'error');
                    return;
                }
                
                const newTransaction = {
                    id: nextId++,
                    date: date,
                    description: description,
                    accountId: accountId,
                    categoryId: categoryId,
                    amount: amount,
                    type: type
                };
                
                transactions.push(newTransaction);
                
                // Update account balance
                const account = accounts.find(acc => acc.id === accountId);
                if (account) {
                    if (type === 'income') {
                        account.balance += amount;
                    } else {
                        account.balance -= amount;
                    }
                }
                
                updateUI();
                
                // Reset form
                document.getElementById('transactionForm').reset();
                document.getElementById('transactionDate').valueAsDate = new Date();
                
                showNotification('Transaction added successfully.', 'success');
            } catch (error) {
                showNotification('Error saving transaction: ' + error.message, 'error');
            }
        }
        
        // Save budget
        function saveBudget(event) {
            event.preventDefault();
            
            try {
                const categoryId = parseInt(document.getElementById('budgetCategory').value);
                const amount = parseFloat(document.getElementById('budgetAmount').value);
                
                if (!categoryId || !amount || amount <= 0) {
                    showNotification('Please select a category and enter a valid budget amount', 'error');
                    return;
                }
                
                budgets[categoryId] = amount;
                updateUI();
                
                // Reset form
                document.getElementById('budgetForm').reset();
                
                showNotification('Budget set successfully.', 'success');
            } catch (error) {
                showNotification('Error saving budget: ' + error.message, 'error');
            }
        }
        
        // Process transfer
        function processTransfer(event) {
            event.preventDefault();
            
            try {
                const fromAccountId = parseInt(document.getElementById('fromAccount').value);
                const toAccountId = parseInt(document.getElementById('toAccount').value);
                const amount = parseFloat(document.getElementById('transferAmount').value);
                const description = document.getElementById('transferDescription').value.trim();
                const date = document.getElementById('transferDate').value;
                
                if (!fromAccountId || !toAccountId || !amount || !description || !date) {
                    showNotification('Please fill in all fields', 'error');
                    return;
                }
                
                if (fromAccountId === toAccountId) {
                    showNotification('Cannot transfer to the same account', 'error');
                    return;
                }
                
                const fromAccount = accounts.find(acc => acc.id === fromAccountId);
                const toAccount = accounts.find(acc => acc.id === toAccountId);
                
                if (!fromAccount || !toAccount) {
                    showNotification('Invalid accounts selected', 'error');
                    return;
                }
                
                if (fromAccount.balance < amount) {
                    showNotification('Insufficient funds in source account', 'error');
                    return;
                }
                
                // Get a default category for transfers
                const transferCategory = categories.find(cat => cat.name === 'Transfer') || categories[0];
                if (!transferCategory) {
                    showNotification('Please add at least one category before making transfers', 'error');
                    return;
                }
                
                // Create transfer transactions
                const transferOut = {
                    id: nextId++,
                    date: date,
                    description: `Transfer to ${toAccount.name}: ${description}`,
                    accountId: fromAccountId,
                    categoryId: transferCategory.id,
                    amount: amount,
                    type: 'expense'
                };
                
                const transferIn = {
                    id: nextId++,
                    date: date,
                    description: `Transfer from ${fromAccount.name}: ${description}`,
                    accountId: toAccountId,
                    categoryId: transferCategory.id,
                    amount: amount,
                    type: 'income'
                };
                
                transactions.push(transferOut);
                transactions.push(transferIn);
                
                // Update account balances
                fromAccount.balance -= amount;
                toAccount.balance += amount;
                
                updateUI();
                
                // Reset form
                document.getElementById('transferForm').reset();
                document.getElementById('transferDate').valueAsDate = new Date();
                
                showNotification('Transfer completed successfully!', 'success');
            } catch (error) {
                showNotification('Error processing transfer: ' + error.message, 'error');
            }
        }
        
        // Delete account
        function deleteAccount(id) {
            if (!confirm('Are you sure you want to delete this account? All transactions associated with this account will also be deleted.')) {
                return;
            }
            
            try {
                // Remove transactions associated with this account
                transactions = transactions.filter(transaction => transaction.accountId !== id);
                
                // Remove the account
                accounts = accounts.filter(account => account.id !== id);
                
                updateUI();
                showNotification('Account deleted successfully.', 'success');
            } catch (error) {
                showNotification('Error deleting account: ' + error.message, 'error');
            }
        }
        
        // Delete category
        function deleteCategory(id) {
            if (!confirm('Are you sure you want to delete this category? Transactions using this category will be moved to the first available category.')) {
                return;
            }
            
            try {
                // Get the first category as fallback
                const fallbackCategoryId = categories.length > 0 ? categories[0].id : null;
                
                if (fallbackCategoryId) {
                    // Update transactions to use the fallback category
                    transactions.forEach(transaction => {
                        if (transaction.categoryId === id) {
                            transaction.categoryId = fallbackCategoryId;
                        }
                    });
                }
                
                // Remove the category
                categories = categories.filter(category => category.id !== id);
                
                updateUI();
                showNotification('Category deleted successfully.', 'success');
            } catch (error) {
                showNotification('Error deleting category: ' + error.message, 'error');
            }
        }
        
        // Delete transaction
        function deleteTransaction(id) {
            if (!confirm('Are you sure you want to delete this transaction?')) {
                return;
            }
            
            try {
                const transaction = transactions.find(t => t.id === id);
                if (transaction) {
                    // Reverse the transaction effect on account balance
                    const account = accounts.find(acc => acc.id === transaction.accountId);
                    if (account) {
                        if (transaction.type === 'income') {
                            account.balance -= transaction.amount;
                        } else {
                            account.balance += transaction.amount;
                        }
                    }
                }
                
                transactions = transactions.filter(transaction => transaction.id !== id);
                updateUI();
                showNotification('Transaction deleted successfully.', 'success');
            } catch (error) {
                showNotification('Error deleting transaction: ' + error.message, 'error');
            }
        }
        
        // Filter transactions
        function filterTransactions() {
            updateUI();
        }
        
        // Clear transaction search
        function clearTransactionSearch() {
            document.getElementById('searchTransactions').value = '';
            updateUI();
        }
        
        // Apply filters
        function applyFilters() {
            updateUI();
        }
        
        // Clear filters
        function clearFilters() {
            document.getElementById('filterDateFrom').value = '';
            document.getElementById('filterDateTo').value = '';
            document.getElementById('filterAccount').value = '';
            document.getElementById('filterCategory').value = '';
            updateUI();
        }
        
        // Generate report
        function generateReport() {
            updateUI();
        }
        
        // Print report
        function printReport() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            if (!startDate || !endDate) {
                showNotification('Please select start and end dates for the report.', 'error');
                return;
            }
            
            // Filter transactions by date range
            const filteredTransactions = transactions.filter(t => {
                if (!t.date) return false;
                return t.date >= startDate && t.date <= endDate;
            });
            
            // Calculate totals
            const totalIncome = filteredTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const totalExpenses = filteredTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const netCashFlow = totalIncome - totalExpenses;
            
            // Update printable section
            document.getElementById('print-period').textContent = `For the period: ${formatDateForPrint(startDate)} to ${formatDateForPrint(endDate)}`;
            document.getElementById('print-total-income').textContent = `‚Çπ${totalIncome.toFixed(2)}`;
            document.getElementById('print-total-expenses').textContent = `‚Çπ${totalExpenses.toFixed(2)}`;
            document.getElementById('print-net-cash-flow').textContent = `‚Çπ${netCashFlow.toFixed(2)}`;
            
            // Create the printable table
            const tableBody = document.getElementById('print-table-body');
            tableBody.innerHTML = '';
            
            filteredTransactions.forEach(transaction => {
                const account = accounts.find(acc => acc.id === transaction.accountId);
                const category = categories.find(cat => cat.id === transaction.categoryId);
                
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${transaction.date ? formatDateForPrint(transaction.date) : ''}</td>
                    <td>${transaction.description}</td>
                    <td>${account ? account.name : 'Unknown'}</td>
                    <td>${category ? category.name : 'Unknown'}</td>
                    <td>${transaction.type}</td>
                    <td>‚Çπ${transaction.amount.toFixed(2)}</td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Show the printable section and print
            const printableElement = document.getElementById('printable-expenses');
            printableElement.style.display = 'block';
            
            window.print();
            
            // Hide the printable section after printing
            printableElement.style.display = 'none';
        }
        
        // Format date for printing
        function formatDateForPrint(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }
        
        // Switch view
        function switchView(view) {
            // Hide all views
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('accountsView').classList.add('hidden');
            document.getElementById('categoriesView').classList.add('hidden');
            document.getElementById('transactionsView').classList.add('hidden');
            document.getElementById('budgetView').classList.add('hidden');
            document.getElementById('transferView').classList.add('hidden');
            document.getElementById('reportsView').classList.add('hidden');
            
            // Show selected view
            document.getElementById(view + 'View').classList.remove('hidden');
            
            // Update active button
            document.querySelectorAll('.view-btn').forEach(btn => {
                if (btn.dataset.view === view) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            updateUI();
        }
        
        // Update UI with data from database
        function updateUI() {
            // Update dropdowns
            updateDropdowns();
            
            // Calculate financial summary
            updateFinancialSummary();
            
            // Update accounts table
            updateAccountsTable();
            
            // Update categories table
            updateCategoriesTable();
            
            // Update transactions table
            updateTransactionsTable();
            
            // Update budget overview
            updateBudgetOverview();
            
            // Update charts
            updateCharts();
            
            // Update status bar
            document.getElementById('statusMessage').textContent = transactions.length > 0 ? 'Expense data loaded' : 'No expense data loaded';
            document.getElementById('transactionCount').textContent = `${transactions.length} transactions`;
        }
        
        // Update dropdowns
        function updateDropdowns() {
            // Update account dropdowns
            const accountDropdowns = [
                'transactionAccount',
                'fromAccount',
                'toAccount',
                'filterAccount'
            ];
            
            accountDropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                dropdown.innerHTML = '<option value="">Select Account</option>';
                
                accounts.forEach(account => {
                    const option = document.createElement('option');
                    option.value = account.id;
                    option.textContent = account.name;
                    dropdown.appendChild(option);
                });
            });
            
            // Update category dropdowns
            const categoryDropdowns = [
                'transactionCategory',
                'budgetCategory',
                'filterCategory'
            ];
            
            categoryDropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                dropdown.innerHTML = '<option value="">Select Category</option>';
                
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    dropdown.appendChild(option);
                });
            });
        }
        
        // Update financial summary
        function updateFinancialSummary() {
            // Calculate total balance
            const totalBalance = accounts.reduce((sum, account) => sum + account.balance, 0);
            
            // Calculate total income and expenses
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const totalExpenses = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const netCashFlow = totalIncome - totalExpenses;
            
            // Update summary cards
            document.getElementById('totalBalance').textContent = `‚Çπ${totalBalance.toFixed(2)}`;
            document.getElementById('totalIncome').textContent = `‚Çπ${totalIncome.toFixed(2)}`;
            document.getElementById('totalExpenses').textContent = `‚Çπ${totalExpenses.toFixed(2)}`;
            document.getElementById('netCashFlow').textContent = `‚Çπ${netCashFlow.toFixed(2)}`;
        }
        
        // Update accounts table
        function updateAccountsTable() {
            const tableBody = document.getElementById('accountsTable');
            tableBody.innerHTML = '';
            
            if (accounts.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px;">No accounts found.</td></tr>';
            } else {
                accounts.forEach(account => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${account.name}</td>
                        <td>${account.type}</td>
                        <td class="${account.balance >= 0 ? 'positive' : 'negative'}">‚Çπ${account.balance.toFixed(2)}</td>
                        <td class="actions">
                            <button class="btn btn-danger btn-sm" onclick="deleteAccount(${account.id})">üóëÔ∏è</button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
        }
        
        // Update categories table
        function updateCategoriesTable() {
            const tableBody = document.getElementById('categoriesTable');
            tableBody.innerHTML = '';
            
            if (categories.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px;">No categories found.</td></tr>';
            } else {
                categories.forEach(category => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${category.name}</td>
                        <td>${category.type}</td>
                        <td><span class="category-color" style="background-color: ${category.color};"></span> ${category.color}</td>
                        <td class="actions">
                            <button class="btn btn-danger btn-sm" onclick="deleteCategory(${category.id})">üóëÔ∏è</button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
        }
        
        // Update transactions table
        function updateTransactionsTable() {
            const tableBody = document.getElementById('transactionsTable');
            tableBody.innerHTML = '';
            
            // Get filters
            const searchTerm = document.getElementById('searchTransactions').value.toLowerCase();
            const dateFrom = document.getElementById('filterDateFrom').value;
            const dateTo = document.getElementById('filterDateTo').value;
            const accountFilter = document.getElementById('filterAccount').value;
            const categoryFilter = document.getElementById('filterCategory').value;
            
            // Filter transactions
            let filteredTransactions = transactions;
            
            if (searchTerm) {
                filteredTransactions = filteredTransactions.filter(t => 
                    t.description.toLowerCase().includes(searchTerm)
                );
            }
            
            if (dateFrom) {
                filteredTransactions = filteredTransactions.filter(t => t.date >= dateFrom);
            }
            
            if (dateTo) {
                filteredTransactions = filteredTransactions.filter(t => t.date <= dateTo);
            }
            
            if (accountFilter) {
                filteredTransactions = filteredTransactions.filter(t => t.accountId == accountFilter);
            }
            
            if (categoryFilter) {
                filteredTransactions = filteredTransactions.filter(t => t.categoryId == categoryFilter);
            }
            
            if (filteredTransactions.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px;">No transactions found.</td></tr>';
            } else {
                // Sort by date (newest first)
                filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                filteredTransactions.forEach(transaction => {
                    const account = accounts.find(acc => acc.id === transaction.accountId);
                    const category = categories.find(cat => cat.id === transaction.categoryId);
                    
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${formatDate(transaction.date)}</td>
                        <td>${transaction.description}</td>
                        <td>${account ? account.name : 'Unknown'}</td>
                        <td>${category ? category.name : 'Unknown'}</td>
                        <td>${transaction.type}</td>
                        <td class="${transaction.type === 'income' ? 'positive' : 'negative'}">
                            ${transaction.type === 'income' ? '+' : '-'}‚Çπ${transaction.amount.toFixed(2)}
                        </td>
                        <td class="actions">
                            <button class="btn btn-danger btn-sm" onclick="deleteTransaction(${transaction.id})">üóëÔ∏è</button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
            
            // Update recent transactions
            const recentTransactionsBody = document.getElementById('recentTransactions');
            recentTransactionsBody.innerHTML = '';
            
            const recent = [...transactions]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
                
            recent.forEach(transaction => {
                const account = accounts.find(acc => acc.id === transaction.accountId);
                const category = categories.find(cat => cat.id === transaction.categoryId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.description}</td>
                    <td>${account ? account.name : 'Unknown'}</td>
                    <td>${category ? category.name : 'Unknown'}</td>
                    <td class="${transaction.type === 'income' ? 'positive' : 'negative'}">
                        ${transaction.type === 'income' ? '+' : '-'}‚Çπ${transaction.amount.toFixed(2)}
                    </td>
                `;
                recentTransactionsBody.appendChild(row);
            });
        }
        
        // Update budget overview
        function updateBudgetOverview() {
            const container = document.getElementById('budgetOverview');
            container.innerHTML = '';
            
            if (Object.keys(budgets).length === 0) {
                container.innerHTML = '<div class="form-section"><p>No budgets set yet. Add a budget above to get started.</p></div>';
                return;
            }
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            Object.keys(budgets).forEach(categoryId => {
                const category = categories.find(cat => cat.id === parseInt(categoryId));
                // Only show budgets for expense categories
                if (category && category.type === 'expense') {
                    const budgetAmount = budgets[categoryId];
                    
                    // Calculate spent amount for current month
                    const spentAmount = transactions
                        .filter(t => {
                            const tDate = new Date(t.date);
                            return t.categoryId === parseInt(categoryId) && 
                                   t.type === 'expense' &&
                                   tDate.getMonth() === currentMonth &&
                                   tDate.getFullYear() === currentYear;
                        })
                        .reduce((sum, t) => sum + t.amount, 0);
                    
                    const percentage = (spentAmount / budgetAmount) * 100;
                    let progressClass = 'budget-normal';
                    if (percentage >= 100) progressClass = 'budget-danger';
                    else if (percentage >= 80) progressClass = 'budget-warning';
                    
                    const budgetCard = document.createElement('div');
                    budgetCard.className = 'form-section';
                    budgetCard.innerHTML = `
                        <h4>${category.name}</h4>
                        <p>Budget: ‚Çπ${budgetAmount.toFixed(2)} | Spent: ‚Çπ${spentAmount.toFixed(2)} | Remaining: ‚Çπ${(budgetAmount - spentAmount).toFixed(2)}</p>
                        <div class="budget-progress">
                            <div class="budget-progress-bar ${progressClass}" style="width: ${Math.min(percentage, 100)}%"></div>
                        </div>
                        <small>${percentage.toFixed(1)}% of budget used</small>
                    `;
                    container.appendChild(budgetCard);
                }
            });
        }
        
        // Update charts
        function updateCharts() {
            updateOverviewChart();
            updateCategoryChart();
            updateCategoryReport();
        }
        
        // Update overview chart
        function updateOverviewChart() {
            const ctx = document.getElementById('overviewChart').getContext('2d');
            
            // Group transactions by month
            const monthlyData = {};
            
            transactions.forEach(transaction => {
                const date = new Date(transaction.date);
                const monthYear = `${date.getFullYear()}-${date.getMonth() + 1}`;
                
                if (!monthlyData[monthYear]) {
                    monthlyData[monthYear] = {
                        income: 0,
                        expenses: 0
                    };
                }
                
                if (transaction.type === 'income') {
                    monthlyData[monthYear].income += transaction.amount;
                } else {
                    monthlyData[monthYear].expenses += transaction.amount;
                }
            });
            
            // Sort months chronologically
            const sortedMonths = Object.keys(monthlyData).sort();
            
            const labels = sortedMonths.map(month => {
                const [year, monthNum] = month.split('-');
                return new Date(year, monthNum - 1).toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            });
            
            const incomeData = sortedMonths.map(month => monthlyData[month].income);
            const expensesData = sortedMonths.map(month => monthlyData[month].expenses);
            
            // Destroy existing chart if it exists
            if (overviewChart) {
                overviewChart.destroy();
            }
            
            // Create new chart
            overviewChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Income',
                            data: incomeData,
                            backgroundColor: 'rgba(76, 175, 80, 0.7)',
                            borderColor: 'rgba(76, 175, 80, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Expenses',
                            data: expensesData,
                            backgroundColor: 'rgba(244, 67, 54, 0.7)',
                            borderColor: 'rgba(244, 67, 54, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‚Çπ' + value;
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ‚Çπ' + context.raw;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update category chart
        function updateCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            // Get date range for report
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            // Filter transactions by date range
            let filteredTransactions = transactions;
            
            if (startDate) {
                filteredTransactions = filteredTransactions.filter(t => t.date >= startDate);
            }
            
            if (endDate) {
                filteredTransactions = filteredTransactions.filter(t => t.date <= endDate);
            }
            
            // Group expenses by category
            const categoryData = {};
            
            filteredTransactions
                .filter(t => t.type === 'expense')
                .forEach(transaction => {
                    const category = categories.find(cat => cat.id === transaction.categoryId);
                    if (category) {
                        if (!categoryData[category.name]) {
                            categoryData[category.name] = {
                                amount: 0,
                                color: category.color
                            };
                        }
                        categoryData[category.name].amount += transaction.amount;
                    }
                });
            
            const labels = Object.keys(categoryData);
            const data = Object.values(categoryData).map(item => item.amount);
            const backgroundColors = Object.values(categoryData).map(item => item.color);
            
            // Destroy existing chart if it exists
            if (categoryChart) {
                categoryChart.destroy();
            }
            
            // Create new chart
            categoryChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: backgroundColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return context.label + ': ‚Çπ' + value + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update category report
        function updateCategoryReport() {
            const tableBody = document.getElementById('categoryReportTable');
            tableBody.innerHTML = '';
            
            // Get date range for report
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            // Filter transactions by date range
            let filteredTransactions = transactions;
            
            if (startDate) {
                filteredTransactions = filteredTransactions.filter(t => t.date >= startDate);
            }
            
            if (endDate) {
                filteredTransactions = filteredTransactions.filter(t => t.date <= endDate);
            }
            
            // Group expenses by category
            const categoryData = {};
            
            filteredTransactions
                .filter(t => t.type === 'expense')
                .forEach(transaction => {
                    const category = categories.find(cat => cat.id === transaction.categoryId);
                    if (category) {
                        if (!categoryData[category.name]) {
                            categoryData[category.name] = {
                                amount: 0,
                                color: category.color
                            };
                        }
                        categoryData[category.name].amount += transaction.amount;
                    }
                });
            
            // Calculate total expenses
            const totalExpenses = Object.values(categoryData).reduce((sum, item) => sum + item.amount, 0);
            
            // Sort categories by amount (descending)
            const sortedCategories = Object.entries(categoryData)
                .sort((a, b) => b[1].amount - a[1].amount);
            
            if (sortedCategories.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="3" style="text-align: center; padding: 20px;">No expense data found for the selected period.</td></tr>';
            } else {
                sortedCategories.forEach(([categoryName, data]) => {
                    const percentage = ((data.amount / totalExpenses) * 100).toFixed(1);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><span class="category-color" style="background-color: ${data.color};"></span> ${categoryName}</td>
                        <td>‚Çπ${data.amount.toFixed(2)}</td>
                        <td>${percentage}%</td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }
        
        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }
        
        // Show notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
